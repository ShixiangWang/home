---
title: "UCSCXenaTools: Download Public Cancer Genomic Data from UCSC Xena Hubs"
author: "Shixiang Wang"
show_toc: true
date: "2020-08-09"
output: 
  tint::tintPdf
type: cv
pdf: ../ucscxenatools-intro.pdf
categories: [r, bioinformatics]
tags: [r, package, UCSCXenaTools]
---



<p><strong>UCSCXenaTools</strong> is an R package for downloading and exploring data from <strong>UCSC Xena data hubs</strong>, which are</p>
<blockquote>
<p>a collection of UCSC-hosted public databases such as TCGA, ICGC, TARGET, GTEx, CCLE, and others. Databases are normalized so they can be combined, linked, filtered, explored and downloaded.</p>
<p>– <a href="https://xena.ucsc.edu/">UCSC Xena</a></p>
</blockquote>
<p>If you use this package in academic field, please cite:</p>
<pre><code>Wang, Shixiang, et al. &quot;The predictive power of tumor mutational burden 
    in lung cancer immunotherapy response is influenced by patients&#39; sex.&quot; 
    International journal of cancer (2019).</code></pre>
<div id="installation" class="section level1">
<h1>Installation</h1>
<p>Install stable release from CRAN with:</p>
<pre class="r"><code>install.packages(&quot;UCSCXenaTools&quot;)</code></pre>
<p>You can also install devel version of <strong>UCSCXenaTools</strong> from github with:</p>
<pre class="r"><code># install.packages(&#39;remotes&#39;)
remotes::install_github(&quot;ShixiangWang/UCSCXenaTools&quot;)</code></pre>
</div>
<div id="data-hub-list" class="section level1">
<h1>Data Hub List</h1>
<p>All datasets are available at <a href="https://xenabrowser.net/datapages/" class="uri">https://xenabrowser.net/datapages/</a>.</p>
<p>Currently, <strong>UCSCXenaTools</strong> supports 10 data hubs of UCSC Xena.</p>
<ul>
<li>UCSC Public Hub: <a href="https://ucscpublic.xenahubs.net" class="uri">https://ucscpublic.xenahubs.net</a></li>
<li>TCGA Hub: <a href="https://tcga.xenahubs.net" class="uri">https://tcga.xenahubs.net</a></li>
<li>GDC Xena Hub: <a href="https://gdc.xenahubs.net" class="uri">https://gdc.xenahubs.net</a></li>
<li>ICGC Xena Hub: <a href="https://icgc.xenahubs.net" class="uri">https://icgc.xenahubs.net</a></li>
<li>Pan-Cancer Atlas Hub: <a href="https://pancanatlas.xenahubs.net" class="uri">https://pancanatlas.xenahubs.net</a></li>
<li>GA4GH (TOIL) Hub: <a href="https://toil.xenahubs.net" class="uri">https://toil.xenahubs.net</a></li>
<li>Treehouse Hub: <a href="https://xena.treehouse.gi.ucsc.edu" class="uri">https://xena.treehouse.gi.ucsc.edu</a></li>
<li>PCAWG Hub: <a href="https://pcawg.xenahubs.net" class="uri">https://pcawg.xenahubs.net</a></li>
<li>ATAC-seq Hub: <a href="https://atacseq.xenahubs.net" class="uri">https://atacseq.xenahubs.net</a></li>
<li>Singel Cell Xena hub: <a href="https://singlecellnew.xenahubs.net" class="uri">https://singlecellnew.xenahubs.net</a></li>
</ul>
<p>Users can update dataset list from the newest version of UCSC Xena by hand with <code>XenaDataUpdate()</code> function, followed
by restarting R and <code>library(UCSCXenaTools)</code>.</p>
<p>If any url of data hubs are changed or a new data hub is online, please remind me by emailing to <a href="mailto:w_shixiang@163.com" class="email">w_shixiang@163.com</a> or <a href="https://github.com/ShixiangWang/UCSCXenaTools/issues">opening an issue on GitHub</a>.</p>
</div>
<div id="usage" class="section level1">
<h1>Usage</h1>
<p>Download UCSC Xena Datasets and load them into R by <strong>UCSCXenaTools</strong> is a workflow with <code>generate</code>, <code>filter</code>, <code>query</code>, <code>download</code> and <code>prepare</code> 5 steps, which are implemented as <code>XenaGenerate</code>, <code>XenaFilter</code>, <code>XenaQuery</code>, <code>XenaDownload</code> and <code>XenaPrepare</code> functions, respectively. They are very clear and easy to use and combine with other packages like <code>dplyr</code>.</p>
<p>To show the basic usage of <strong>UCSCXenaTools</strong>, we will download clinical data of LUNG, LUAD, LUSC from TCGA (hg19 version) data hub.</p>
<div id="xenadata-data.frame" class="section level2">
<h2>XenaData data.frame</h2>
<p>Begin from version <code>0.2.0</code>, <strong>UCSCXenaTools</strong> uses a <code>data.frame</code> object (built in package, someone may call it <code>tibble</code>) <code>XenaData</code> to generate an instance of <code>XenaHub</code> class to record general information of all datasets of UCSC Xena Data Hubs.</p>
<p>You can load <code>XenaData</code> after loading <code>UCSCXenaTools</code> into R.</p>
<pre class="r"><code>library(UCSCXenaTools)
#&gt; =========================================================================================
#&gt; UCSCXenaTools version 1.3.3
#&gt; Project URL: https://github.com/ropensci/UCSCXenaTools
#&gt; Usages: https://cran.r-project.org/web/packages/UCSCXenaTools/vignettes/USCSXenaTools.html
#&gt; 
#&gt; If you use it in published research, please cite:
#&gt; Wang et al., (2019). The UCSCXenaTools R package: a toolkit for accessing genomics data
#&gt;   from UCSC Xena platform, from cancer multi-omics to single-cell RNA-seq.
#&gt;   Journal of Open Source Software, 4(40), 1627, https://doi.org/10.21105/joss.01627
#&gt; =========================================================================================
#&gt;                               --Enjoy it--
data(XenaData)

head(XenaData)
#&gt; # A tibble: 6 x 17
#&gt;   XenaHosts XenaHostNames XenaCohorts XenaDatasets SampleCount DataSubtype Label
#&gt;   &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;              &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;
#&gt; 1 https://… publicHub     Breast Can… ucsfNeve_pu…          51 gene expre… Neve…
#&gt; 2 https://… publicHub     Breast Can… ucsfNeve_pu…          57 phenotype   Phen…
#&gt; 3 https://… publicHub     Glioma (Ko… kotliarov20…         194 copy number Kotl…
#&gt; 4 https://… publicHub     Glioma (Ko… kotliarov20…         194 phenotype   Phen…
#&gt; 5 https://… publicHub     Lung Cance… weir2007_pu…         383 copy number CGH  
#&gt; 6 https://… publicHub     Lung Cance… weir2007_pu…         383 phenotype   Phen…
#&gt; # … with 10 more variables: Type &lt;chr&gt;, AnatomicalOrigin &lt;chr&gt;,
#&gt; #   SampleType &lt;chr&gt;, Tags &lt;chr&gt;, ProbeMap &lt;chr&gt;, LongTitle &lt;chr&gt;,
#&gt; #   Citation &lt;chr&gt;, Version &lt;chr&gt;, Unit &lt;chr&gt;, Platform &lt;chr&gt;</code></pre>
<p>Names of all hub names/urls can be accessed by object <code>.xena_hosts</code>:</p>
<pre class="r"><code>UCSCXenaTools:::.xena_hosts
#&gt;        https://ucscpublic.xenahubs.net              https://tcga.xenahubs.net 
#&gt;                            &quot;publicHub&quot;                              &quot;tcgaHub&quot; 
#&gt;               https://gdc.xenahubs.net              https://icgc.xenahubs.net 
#&gt;                               &quot;gdcHub&quot;                              &quot;icgcHub&quot; 
#&gt;              https://toil.xenahubs.net       https://pancanatlas.xenahubs.net 
#&gt;                              &quot;toilHub&quot;                       &quot;pancanAtlasHub&quot; 
#&gt; https://xena.treehouse.gi.ucsc.edu:443             https://pcawg.xenahubs.net 
#&gt;                         &quot;treehouseHub&quot;                             &quot;pcawgHub&quot; 
#&gt;           https://atacseq.xenahubs.net     https://singlecellnew.xenahubs.net 
#&gt;                           &quot;atacseqHub&quot;                        &quot;singlecellHub&quot; 
#&gt;         https://kidsfirst.xenahubs.net 
#&gt;                         &quot;kidsfirstHub&quot;</code></pre>
</div>
<div id="generate-a-xenahub-object" class="section level2">
<h2>Generate a XenaHub object</h2>
<p>This can be implemented by <code>XenaGenerate</code> function, which generates <code>XenaHub</code> object from <code>XenaData</code> data frame.</p>
<pre class="r"><code>XenaGenerate()
#&gt; class: XenaHub 
#&gt; hosts():
#&gt;   https://ucscpublic.xenahubs.net
#&gt;   https://tcga.xenahubs.net
#&gt;   https://gdc.xenahubs.net
#&gt;   https://icgc.xenahubs.net
#&gt;   https://toil.xenahubs.net
#&gt;   https://pancanatlas.xenahubs.net
#&gt;   https://xena.treehouse.gi.ucsc.edu:443
#&gt;   https://pcawg.xenahubs.net
#&gt;   https://atacseq.xenahubs.net
#&gt;   https://singlecellnew.xenahubs.net
#&gt;   https://kidsfirst.xenahubs.net
#&gt; cohorts() (151 total):
#&gt;   Breast Cancer Cell Lines (Neve 2006)
#&gt;   Glioma (Kotliarov 2006)
#&gt;   Lung Cancer CGH (Weir 2007)
#&gt;   ...
#&gt;   Pediatric Brain Tumor Atlas: PNOC
#&gt;   Pediatric Brain Tumor Atlas: CBTTC
#&gt; datasets() (1641 total):
#&gt;   ucsfNeve_public/ucsfNeveExp_genomicMatrix
#&gt;   ucsfNeve_public/ucsfNeve_public_clinicalMatrix
#&gt;   kotliarov2006_public/kotliarov2006_genomicMatrix
#&gt;   ...
#&gt;   CBTTC/Participants.txt
#&gt;   CBTTC/survival.txt</code></pre>
<p>You can set <code>subset</code> argument to narrow datasets.</p>
<pre class="r"><code>XenaGenerate(subset = XenaHostNames == &quot;tcgaHub&quot;)
#&gt; class: XenaHub 
#&gt; hosts():
#&gt;   https://tcga.xenahubs.net
#&gt; cohorts() (38 total):
#&gt;   TCGA Ovarian Cancer (OV)
#&gt;   TCGA Kidney Clear Cell Carcinoma (KIRC)
#&gt;   TCGA Lower Grade Glioma (LGG)
#&gt;   ...
#&gt;   TCGA Colon Cancer (COAD)
#&gt;   TCGA Formalin Fixed Paraffin-Embedded Pilot Phase II (FPPP)
#&gt; datasets() (715 total):
#&gt;   TCGA.OV.sampleMap/HumanMethylation27
#&gt;   TCGA.OV.sampleMap/HumanMethylation450
#&gt;   TCGA.OV.sampleMap/Gistic2_CopyNumber_Gistic2_all_data_by_genes
#&gt;   ...
#&gt;   TCGA.FPPP.sampleMap/miRNA_HiSeq_gene
#&gt;   TCGA.FPPP.sampleMap/FPPP_clinicalMatrix</code></pre>
<blockquote>
<p>You can also use <code>XenaHub()</code> to generate a <code>XenaHub</code> object for API communication, but it is not recommended.</p>
</blockquote>
<p>It’s possible to extract info from <code>XenaHub</code> object by <code>hosts()</code>, <code>cohorts()</code> and <code>datasets()</code>.</p>
<pre class="r"><code>xe = XenaGenerate(subset = XenaHostNames == &quot;tcgaHub&quot;)
# get hosts
hosts(xe)
#&gt; [1] &quot;https://tcga.xenahubs.net&quot;
# get cohorts
head(cohorts(xe))
#&gt; [1] &quot;TCGA Ovarian Cancer (OV)&quot;                   
#&gt; [2] &quot;TCGA Kidney Clear Cell Carcinoma (KIRC)&quot;    
#&gt; [3] &quot;TCGA Lower Grade Glioma (LGG)&quot;              
#&gt; [4] &quot;TCGA Kidney Papillary Cell Carcinoma (KIRP)&quot;
#&gt; [5] &quot;TCGA Pan-Cancer (PANCAN)&quot;                   
#&gt; [6] &quot;TCGA Bile Duct Cancer (CHOL)&quot;
# get datasets
head(datasets(xe))
#&gt; [1] &quot;TCGA.OV.sampleMap/HumanMethylation27&quot;                          
#&gt; [2] &quot;TCGA.OV.sampleMap/HumanMethylation450&quot;                         
#&gt; [3] &quot;TCGA.OV.sampleMap/Gistic2_CopyNumber_Gistic2_all_data_by_genes&quot;
#&gt; [4] &quot;TCGA.OV.sampleMap/OV_clinicalMatrix&quot;                           
#&gt; [5] &quot;TCGA.OV.sampleMap/RPPA_RBN&quot;                                    
#&gt; [6] &quot;TCGA.OV.sampleMap/HT_HG-U133A&quot;</code></pre>
<p>Pipe operator <code>%&gt;%</code> can also be used here.</p>
<pre class="r"><code>library(dplyr)
XenaData %&gt;% filter(XenaHostNames == &quot;tcgaHub&quot;, grepl(&quot;BRCA&quot;, XenaCohorts), grepl(&quot;Path&quot;, 
    XenaDatasets)) %&gt;% XenaGenerate()
#&gt; class: XenaHub 
#&gt; hosts():
#&gt;   
#&gt; cohorts() (0 total):
#&gt;   
#&gt; datasets() (0 total):
#&gt; </code></pre>
<p>Sometimes we only know some keywords, <code>XenaScan()</code> can be used to scan all rows to detect if
the keywords exist in <code>XenaData</code>.</p>
<pre class="r"><code>x1 = XenaScan(pattern = &quot;Blood&quot;)
x2 = XenaScan(pattern = &quot;LUNG&quot;, ignore.case = FALSE)

x1 %&gt;% XenaGenerate()
#&gt; class: XenaHub 
#&gt; hosts():
#&gt;   https://ucscpublic.xenahubs.net
#&gt;   https://tcga.xenahubs.net
#&gt; cohorts() (6 total):
#&gt;   Connectivity Map
#&gt;   TARGET Acute Lymphoblastic Leukemia
#&gt;   Pediatric tumor (Khan)
#&gt;   Acute lymphoblastic leukemia (Mullighan 2008)
#&gt;   TCGA Pan-Cancer (PANCAN)
#&gt;   TCGA Acute Myeloid Leukemia (LAML)
#&gt; datasets() (28 total):
#&gt;   cmap/rankMatrix_reverse
#&gt;   TARGET_ALL/TARGETcnv_genomicMatrix
#&gt;   TARGET_ALL/TARGETexp_genomicMatrix
#&gt;   ...
#&gt;   TCGA.LAML.sampleMap/mutation_wustl
#&gt;   TCGA.LAML.sampleMap/mutation_wustl_gene
x2 %&gt;% XenaGenerate()
#&gt; class: XenaHub 
#&gt; hosts():
#&gt;   https://tcga.xenahubs.net
#&gt; cohorts() (1 total):
#&gt;   TCGA Lung Cancer (LUNG)
#&gt; datasets() (15 total):
#&gt;   TCGA.LUNG.sampleMap/HumanMethylation27
#&gt;   TCGA.LUNG.sampleMap/HumanMethylation450
#&gt;   TCGA.LUNG.sampleMap/Gistic2_CopyNumber_Gistic2_all_data_by_genes
#&gt;   ...
#&gt;   mc3/LUNG_mc3.txt
#&gt;   mc3_gene_level/LUNG_mc3_gene_level.txt</code></pre>
</div>
<div id="filter" class="section level2">
<h2>Filter</h2>
<p>There are too many datasets in <code>xe</code>, you can filter them by <code>XenaFilter</code> function. Regular expression can be used here.</p>
<pre class="r"><code>(xe2 &lt;- XenaFilter(xe, filterDatasets = &quot;clinical&quot;))
#&gt; class: XenaHub 
#&gt; hosts():
#&gt;   https://tcga.xenahubs.net
#&gt; cohorts() (37 total):
#&gt;   TCGA Ovarian Cancer (OV)
#&gt;   TCGA Kidney Clear Cell Carcinoma (KIRC)
#&gt;   TCGA Lower Grade Glioma (LGG)
#&gt;   ...
#&gt;   TCGA Colon Cancer (COAD)
#&gt;   TCGA Formalin Fixed Paraffin-Embedded Pilot Phase II (FPPP)
#&gt; datasets() (37 total):
#&gt;   TCGA.OV.sampleMap/OV_clinicalMatrix
#&gt;   TCGA.KIRC.sampleMap/KIRC_clinicalMatrix
#&gt;   TCGA.LGG.sampleMap/LGG_clinicalMatrix
#&gt;   ...
#&gt;   TCGA.COAD.sampleMap/COAD_clinicalMatrix
#&gt;   TCGA.FPPP.sampleMap/FPPP_clinicalMatrix</code></pre>
<p>Then select <code>LUAD</code>, <code>LUSC</code> and <code>LUNG</code> 3 datasets.</p>
<pre class="r"><code>xe2 &lt;- XenaFilter(xe2, filterDatasets = &quot;LUAD|LUSC|LUNG&quot;)</code></pre>
<p>Pipe can be used here.</p>
<pre class="r"><code>xe %&gt;% XenaFilter(filterDatasets = &quot;clinical&quot;) %&gt;% XenaFilter(filterDatasets = &quot;luad|lusc|lung&quot;)
#&gt; class: XenaHub 
#&gt; hosts():
#&gt;   https://tcga.xenahubs.net
#&gt; cohorts() (3 total):
#&gt;   TCGA Lung Cancer (LUNG)
#&gt;   TCGA Lung Adenocarcinoma (LUAD)
#&gt;   TCGA Lung Squamous Cell Carcinoma (LUSC)
#&gt; datasets() (3 total):
#&gt;   TCGA.LUNG.sampleMap/LUNG_clinicalMatrix
#&gt;   TCGA.LUAD.sampleMap/LUAD_clinicalMatrix
#&gt;   TCGA.LUSC.sampleMap/LUSC_clinicalMatrix</code></pre>
</div>
<div id="browse-datasets" class="section level2">
<h2>Browse datasets</h2>
<p>Sometimes, you may want to check data before you query and download data.
A new feature <code>XenaBrowse</code> is implemented in <strong>UCSCXenaTools</strong>.</p>
<p>Create two XenaHub objects:</p>
<ul>
<li><code>to_browse</code> - a XenaHub object contains a cohort and a dataset.</li>
<li><code>to_browse2</code> - a XenaHub object contains 2 cohorts and 2 datasets.</li>
</ul>
<pre class="r"><code>to_browse &lt;- XenaGenerate(subset = XenaHostNames == &quot;tcgaHub&quot;) %&gt;% XenaFilter(filterDatasets = &quot;clinical&quot;) %&gt;% 
    XenaFilter(filterDatasets = &quot;LUAD&quot;)

to_browse
#&gt; class: XenaHub 
#&gt; hosts():
#&gt;   https://tcga.xenahubs.net
#&gt; cohorts() (1 total):
#&gt;   TCGA Lung Adenocarcinoma (LUAD)
#&gt; datasets() (1 total):
#&gt;   TCGA.LUAD.sampleMap/LUAD_clinicalMatrix

to_browse2 &lt;- XenaGenerate(subset = XenaHostNames == &quot;tcgaHub&quot;) %&gt;% XenaFilter(filterDatasets = &quot;clinical&quot;) %&gt;% 
    XenaFilter(filterDatasets = &quot;LUAD|LUSC&quot;)

to_browse2
#&gt; class: XenaHub 
#&gt; hosts():
#&gt;   https://tcga.xenahubs.net
#&gt; cohorts() (2 total):
#&gt;   TCGA Lung Adenocarcinoma (LUAD)
#&gt;   TCGA Lung Squamous Cell Carcinoma (LUSC)
#&gt; datasets() (2 total):
#&gt;   TCGA.LUAD.sampleMap/LUAD_clinicalMatrix
#&gt;   TCGA.LUSC.sampleMap/LUSC_clinicalMatrix</code></pre>
<p><code>XenaBrowse()</code> function can be used to browse dataset/cohort links using your default web browser.
At default, this function limit one dataset/cohort for preventing user to open too many links at once.</p>
<pre class="r"><code># This will open you web browser
XenaBrowse(to_browse)

XenaBrowse(to_browse, type = &quot;cohort&quot;)</code></pre>
<pre class="r"><code># This will throw error
XenaBrowse(to_browse2)
#&gt; Error in XenaBrowse(to_browse2): This function limite 1 dataset to browse.
#&gt;  Set multiple to TRUE if you want to browse multiple links.

XenaBrowse(to_browse2, type = &quot;cohort&quot;)
#&gt; Error in XenaBrowse(to_browse2, type = &quot;cohort&quot;): This function limite 1 cohort to browse. 
#&gt;  Set multiple to TRUE if you want to browse multiple links.</code></pre>
<p>When you make sure you want to open multiple links, you can set <code>multiple</code> option to <code>TRUE</code>.</p>
<pre class="r"><code>XenaBrowse(to_browse2, multiple = TRUE)
XenaBrowse(to_browse2, type = &quot;cohort&quot;, multiple = TRUE)</code></pre>
</div>
<div id="query" class="section level2">
<h2>Query</h2>
<p>Create a query before downloading data.</p>
<pre class="r"><code>xe2_query = XenaQuery(xe2)
#&gt; This will check url status, please be patient.
xe2_query
#&gt;                       hosts                                datasets
#&gt; 1 https://tcga.xenahubs.net TCGA.LUNG.sampleMap/LUNG_clinicalMatrix
#&gt; 2 https://tcga.xenahubs.net TCGA.LUAD.sampleMap/LUAD_clinicalMatrix
#&gt; 3 https://tcga.xenahubs.net TCGA.LUSC.sampleMap/LUSC_clinicalMatrix
#&gt;                                                                          url
#&gt; 1 https://tcga.xenahubs.net/download/TCGA.LUNG.sampleMap/LUNG_clinicalMatrix
#&gt; 2 https://tcga.xenahubs.net/download/TCGA.LUAD.sampleMap/LUAD_clinicalMatrix
#&gt; 3 https://tcga.xenahubs.net/download/TCGA.LUSC.sampleMap/LUSC_clinicalMatrix</code></pre>
</div>
<div id="download" class="section level2">
<h2>Download</h2>
<p>Default, data will be downloaded to system temp directory. You can specify the path.</p>
<p>If the data exists, command will not run to download them, but you can force it by <code>force</code> option.</p>
<pre class="r"><code>destdir = file.path(tempdir(), &quot;test&quot;)
xe2_download = XenaDownload(xe2_query, destdir = destdir, trans_slash = TRUE)
#&gt; All downloaded files will under directory /var/folders/bj/nw1w4g1j37ddpgb6zmh3sfh80000gn/T//RtmpG4580z/test.
#&gt; Downloading TCGA.LUNG.sampleMap__LUNG_clinicalMatrix
#&gt; Downloading TCGA.LUAD.sampleMap__LUAD_clinicalMatrix
#&gt; Downloading TCGA.LUSC.sampleMap__LUSC_clinicalMatrix
#&gt; Note file names inherit from names in datasets column
#&gt;   and &#39;/&#39; all changed to &#39;__&#39;.</code></pre>
<p>Of note, at default, the downloaded files will keep same directory structure as Xena. You can set <code>trans_slash</code> to TRUE, it will transform
<code>/</code> in dataset id to <code>__</code>, this will make all downloaded files are under same directory.</p>
</div>
<div id="prepare" class="section level2">
<h2>Prepare</h2>
<p>There are 4 ways to prepare data to R.</p>
<pre class="r"><code># way1: directory
cli1 = XenaPrepare(destdir)
names(cli1)
#&gt; [1] &quot;TCGA.LUAD.sampleMap__LUAD_clinicalMatrix&quot;
#&gt; [2] &quot;TCGA.LUNG.sampleMap__LUNG_clinicalMatrix&quot;
#&gt; [3] &quot;TCGA.LUSC.sampleMap__LUSC_clinicalMatrix&quot;</code></pre>
<pre class="r"><code># way2: local files
cli2 = XenaPrepare(file.path(destdir, &quot;/TCGA.LUAD.sampleMap__LUAD_clinicalMatrix&quot;))
class(cli2)
#&gt; [1] &quot;spec_tbl_df&quot; &quot;tbl_df&quot;      &quot;tbl&quot;         &quot;data.frame&quot;</code></pre>
<pre><code># way3: urls
cli3 = XenaPrepare(xe2_download$url[1:2])
names(cli3)
## [1] &quot;LUSC_clinicalMatrix&quot; &quot;LUNG_clinicalMatrix&quot;</code></pre>
<pre class="r"><code># way4: xenadownload object
cli4 = XenaPrepare(xe2_download)
names(cli4)
#&gt; [1] &quot;TCGA.LUNG.sampleMap__LUNG_clinicalMatrix&quot;
#&gt; [2] &quot;TCGA.LUAD.sampleMap__LUAD_clinicalMatrix&quot;
#&gt; [3] &quot;TCGA.LUSC.sampleMap__LUSC_clinicalMatrix&quot;</code></pre>
<p>From v0.2.6, <code>XenaPrepare()</code> can enable chunk feature when file is too big and user only need subset of file.</p>
<p>Following code show how to subset some rows or columns of files, <code>sample</code> is the name of the first column, user can directly use it in logical expression, <code>x</code> can be a representation of data frame user wanna do subset operation. More custom operation can be set as a function and pass to <code>callback</code> option.</p>
<pre><code># select rows which sample (gene symbol here) in &quot;HIF3A&quot; or &quot;RNF17&quot;
testRNA = UCSCXenaTools::XenaPrepare(&quot;~/Download/HiSeqV2.gz&quot;, use_chunk = TRUE, subset_rows = sample %in% c(&quot;HIF3A&quot;, &quot;RNF17&quot;))
# only keep 1 to 3 columns
testRNA = UCSCXenaTools::XenaPrepare(&quot;~/Download/HiSeqV2.gz&quot;, use_chunk = TRUE, select_cols = colnames(x)[1:3])</code></pre>
</div>
</div>
<div id="download-tcga-data-with-readable-options" class="section level1">
<h1>Download TCGA data with readable options</h1>
<div id="gettcgadata" class="section level2">
<h2>getTCGAdata</h2>
<p><code>getTCGAdata</code> provides a more readable way for downloading TCGA (hg19 version, different from <code>gdcHub</code>) datasets, user can specify multiple options to select data and corresponding file type to download. Default this function will return a list include <code>XenaHub</code> object and selected datasets information. Once you are sure the datasets are exactly what you want, <code>download</code> can be set to <code>TRUE</code> to download the data.</p>
<p>Check arguments of <code>getTCGAdata</code>:</p>
<pre class="r"><code>args(getTCGAdata)
#&gt; function (project = NULL, clinical = TRUE, download = FALSE, 
#&gt;     forceDownload = FALSE, destdir = tempdir(), mRNASeq = FALSE, 
#&gt;     mRNAArray = FALSE, mRNASeqType = &quot;normalized&quot;, miRNASeq = FALSE, 
#&gt;     exonRNASeq = FALSE, RPPAArray = FALSE, ReplicateBaseNormalization = FALSE, 
#&gt;     Methylation = FALSE, MethylationType = c(&quot;27K&quot;, &quot;450K&quot;), 
#&gt;     GeneMutation = FALSE, SomaticMutation = FALSE, GisticCopyNumber = FALSE, 
#&gt;     Gistic2Threshold = TRUE, CopyNumberSegment = FALSE, RemoveGermlineCNV = TRUE, 
#&gt;     ...) 
#&gt; NULL

# or run ??getTCGAdata to read documentation</code></pre>
<p>Select one or more projects, default will select only clinical datasets:</p>
<pre class="r"><code>getTCGAdata(c(&quot;UVM&quot;, &quot;LUAD&quot;))
#&gt; $Xena
#&gt; class: XenaHub 
#&gt; hosts():
#&gt;   https://tcga.xenahubs.net
#&gt; cohorts() (2 total):
#&gt;   TCGA Lung Adenocarcinoma (LUAD)
#&gt;   TCGA Ocular melanomas (UVM)
#&gt; datasets() (2 total):
#&gt;   TCGA.LUAD.sampleMap/LUAD_clinicalMatrix
#&gt;   TCGA.UVM.sampleMap/UVM_clinicalMatrix
#&gt; 
#&gt; $DataInfo
#&gt; # A tibble: 2 x 20
#&gt;   XenaHosts XenaHostNames XenaCohorts XenaDatasets SampleCount DataSubtype Label
#&gt;   &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;              &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;
#&gt; 1 https://… tcgaHub       TCGA Lung … TCGA.LUAD.s…         706 phenotype   Phen…
#&gt; 2 https://… tcgaHub       TCGA Ocula… TCGA.UVM.sa…          80 phenotype   Phen…
#&gt; # … with 13 more variables: Type &lt;chr&gt;, AnatomicalOrigin &lt;chr&gt;,
#&gt; #   SampleType &lt;chr&gt;, Tags &lt;chr&gt;, ProbeMap &lt;chr&gt;, LongTitle &lt;chr&gt;,
#&gt; #   Citation &lt;chr&gt;, Version &lt;chr&gt;, Unit &lt;chr&gt;, Platform &lt;chr&gt;, ProjectID &lt;chr&gt;,
#&gt; #   DataType &lt;chr&gt;, FileType &lt;chr&gt;

tcga_data = getTCGAdata(c(&quot;UVM&quot;, &quot;LUAD&quot;))

# only return XenaHub object
tcga_data$Xena
#&gt; class: XenaHub 
#&gt; hosts():
#&gt;   https://tcga.xenahubs.net
#&gt; cohorts() (2 total):
#&gt;   TCGA Lung Adenocarcinoma (LUAD)
#&gt;   TCGA Ocular melanomas (UVM)
#&gt; datasets() (2 total):
#&gt;   TCGA.LUAD.sampleMap/LUAD_clinicalMatrix
#&gt;   TCGA.UVM.sampleMap/UVM_clinicalMatrix

# only return datasets information
tcga_data$DataInfo
#&gt; # A tibble: 2 x 20
#&gt;   XenaHosts XenaHostNames XenaCohorts XenaDatasets SampleCount DataSubtype Label
#&gt;   &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;              &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;
#&gt; 1 https://… tcgaHub       TCGA Lung … TCGA.LUAD.s…         706 phenotype   Phen…
#&gt; 2 https://… tcgaHub       TCGA Ocula… TCGA.UVM.sa…          80 phenotype   Phen…
#&gt; # … with 13 more variables: Type &lt;chr&gt;, AnatomicalOrigin &lt;chr&gt;,
#&gt; #   SampleType &lt;chr&gt;, Tags &lt;chr&gt;, ProbeMap &lt;chr&gt;, LongTitle &lt;chr&gt;,
#&gt; #   Citation &lt;chr&gt;, Version &lt;chr&gt;, Unit &lt;chr&gt;, Platform &lt;chr&gt;, ProjectID &lt;chr&gt;,
#&gt; #   DataType &lt;chr&gt;, FileType &lt;chr&gt;</code></pre>
<p>Set <code>download=TRUE</code> to download data, default data will be downloaded to system temp directory (you can specify the path with <code>destdir</code> option):</p>
<pre class="r"><code># only download clinical data
getTCGAdata(c(&quot;UVM&quot;, &quot;LUAD&quot;), download = TRUE)</code></pre>
<p><strong>Support Data Type and Options</strong>:</p>
<ul>
<li>clinical information: <code>clinical</code></li>
<li>mRNA Sequencing: <code>mRNASeq</code></li>
<li>mRNA microarray: <code>mRNAArray</code></li>
<li>miRNA Sequencing: <code>miRNASeq</code></li>
<li>exon Sequencing: <code>exonRNASeq</code></li>
<li>RPPA array: <code>RPPAArray</code></li>
<li>DNA Methylation: <code>Methylation</code></li>
<li>Gene mutation: <code>GeneMutation</code></li>
<li>Somatic mutation: <code>SomaticMutation</code></li>
<li>Gistic2 Copy Number: <code>GisticCopyNumber</code></li>
<li>Copy Number Segment: <code>CopyNumberSegment</code></li>
</ul>
<blockquote>
<p>other data type supported by Xena cannot download use this function. Please refer to <code>downloadTCGA</code> function or <code>XenaGenerate</code> function.</p>
</blockquote>
<p><strong>NOTE</strong>: Sequencing data are all based on Illumina Hiseq platform, other platform (Illumina GA) data supported by Xena cannot download using this function. This is for building consistent data download flow. Mutation use <code>broad automated</code> version (except <code>PANCAN</code> use <code>MC3 Public Version</code>). If you wan to download other datasets, please refer to <code>downloadTCGA</code> function or <code>XenaGenerate</code> function.</p>
</div>
<div id="download-any-tcga-data-by-datatypes-and-filetypes" class="section level2">
<h2>Download any TCGA data by datatypes and filetypes</h2>
<p><code>downloadTCGA</code> function can be used to download any TCGA data supported by Xena, but in a way different from <code>getTCGAdata</code> function.</p>
<pre class="r"><code># download RNASeq data (use UVM as an example)
downloadTCGA(project = &quot;UVM&quot;, data_type = &quot;Gene Expression RNASeq&quot;, file_type = &quot;IlluminaHiSeq RNASeqV2&quot;)</code></pre>
<p>See the arguments:</p>
<pre class="r"><code>args(downloadTCGA)
#&gt; function (project = NULL, data_type = NULL, file_type = NULL, 
#&gt;     destdir = tempdir(), force = FALSE, ...) 
#&gt; NULL</code></pre>
<p>Except <code>destdir</code> option, you only need to select three arguments for downloading data. Even throught the number is far less than <code>getTCGAdata</code>, it is more complex than the latter.</p>
<p>Before you download data, you need spare some time to figure out what data type and file type available and what your datasets have.</p>
<p><code>availTCGA</code> can return all information you need:</p>
<pre class="r"><code>availTCGA()
#&gt; Note not all projects have listed data types and file types, you can use showTCGA function to check if exist
#&gt; $ProjectID
#&gt;  [1] &quot;OV&quot;       &quot;KIRC&quot;     &quot;LGG&quot;      &quot;KIRP&quot;     &quot;PANCAN&quot;   &quot;CHOL&quot;    
#&gt;  [7] &quot;COADREAD&quot; &quot;ACC&quot;      &quot;CESC&quot;     &quot;READ&quot;     &quot;SARC&quot;     &quot;DLBC&quot;    
#&gt; [13] &quot;PRAD&quot;     &quot;LUNG&quot;     &quot;LIHC&quot;     &quot;KICH&quot;     &quot;HNSC&quot;     &quot;PCPG&quot;    
#&gt; [19] &quot;ESCA&quot;     &quot;THCA&quot;     &quot;LUAD&quot;     &quot;LAML&quot;     &quot;BLCA&quot;     &quot;SKCM&quot;    
#&gt; [25] &quot;LUSC&quot;     &quot;TGCT&quot;     &quot;PAAD&quot;     &quot;GBM&quot;      &quot;STAD&quot;     &quot;MESO&quot;    
#&gt; [31] &quot;UVM&quot;      &quot;GBMLGG&quot;   &quot;THYM&quot;     &quot;UCEC&quot;     &quot;BRCA&quot;     &quot;UCS&quot;     
#&gt; [37] &quot;COAD&quot;     &quot;FPPP&quot;    
#&gt; 
#&gt; $DataType
#&gt;  [1] &quot;DNA Methylation&quot;                       
#&gt;  [2] &quot;Gene Level Copy Number&quot;                
#&gt;  [3] &quot;Phenotype&quot;                             
#&gt;  [4] &quot;Protein Expression RPPA&quot;               
#&gt;  [5] &quot;Gene Expression Array&quot;                 
#&gt;  [6] &quot;Gene Expression RNASeq&quot;                
#&gt;  [7] &quot;Copy Number Segments&quot;                  
#&gt;  [8] &quot;miRNA Mature Strand Expression RNASeq&quot; 
#&gt;  [9] &quot;Exon Expression RNASeq&quot;                
#&gt; [10] &quot;Transcription Factor Regulatory Impact&quot;
#&gt; [11] &quot;PARADIGM Pathway Activity&quot;             
#&gt; [12] NA                                      
#&gt; [13] &quot;Gene Somatic Non-silent Mutation&quot;      
#&gt; [14] &quot;Somatic Mutation&quot;                      
#&gt; [15] &quot;Signatures&quot;                            
#&gt; [16] &quot;iCluster&quot;                              
#&gt; 
#&gt; $FileType
#&gt;  [1] &quot;Methylation27K&quot;                            
#&gt;  [2] &quot;Methylation450K&quot;                           
#&gt;  [3] &quot;Gistic2&quot;                                   
#&gt;  [4] &quot;Clinical Information&quot;                      
#&gt;  [5] &quot;RPPA normalized by RBN&quot;                    
#&gt;  [6] &quot;Affymetrix U133A Microarray&quot;               
#&gt;  [7] &quot;IlluminaHiSeq RNASeqV2 in percentile rank&quot; 
#&gt;  [8] &quot;IlluminaHiSeq RNASeqV2 pancan normalized&quot;  
#&gt;  [9] &quot;IlluminaHiSeq RNASeqV2&quot;                    
#&gt; [10] &quot;IlluminaHiSeq RNASeq&quot;                      
#&gt; [11] &quot;After remove germline cnv&quot;                 
#&gt; [12] &quot;Agilent 244K Microarray&quot;                   
#&gt; [13] &quot;Gistic2 thresholded&quot;                       
#&gt; [14] &quot;RPPA&quot;                                      
#&gt; [15] &quot;Before remove germline cnv&quot;                
#&gt; [16] &quot;Gene Expression Subtype&quot;                   
#&gt; [17] &quot;RABIT Use Agilent 244K Microarray&quot;         
#&gt; [18] &quot;RABIT Use Affymetrix U133A Microarray&quot;     
#&gt; [19] &quot;Platform-corrected PANCAN12 dataset&quot;       
#&gt; [20] NA                                          
#&gt; [21] &quot;IlluminaGA RNASeq&quot;                         
#&gt; [22] &quot;RABIT Use IlluminaHiSeq RNASeqV2&quot;          
#&gt; [23] &quot;RABIT Use IlluminaHiSeq RNASeq&quot;            
#&gt; [24] &quot;MethylMix&quot;                                 
#&gt; [25] &quot;IlluminaGA RNASeqV2&quot;                       
#&gt; [26] &quot;broad automated&quot;                           
#&gt; [27] &quot;wustl automated&quot;                           
#&gt; [28] &quot;RABIT Use IlluminaGA RNASeqV2&quot;             
#&gt; [29] &quot;RABIT Use IlluminaGA RNASeq&quot;               
#&gt; [30] &quot;Batch effects normalized&quot;                  
#&gt; [31] &quot;MC3 Public Version&quot;                        
#&gt; [32] &quot;TCGA Sample Type and Primary Disease&quot;      
#&gt; [33] &quot;RPPA pancan normalized&quot;                    
#&gt; [34] &quot;Tumor copy number&quot;                         
#&gt; [35] &quot;Genome-wide DNA Damage Footprint HRD Score&quot;
#&gt; [36] &quot;TCGA Molecular Subtype&quot;                    
#&gt; [37] &quot;iCluster cluster assignments&quot;              
#&gt; [38] &quot;iCluster latent variables&quot;                 
#&gt; [39] &quot;RNA based StemnessScore&quot;                   
#&gt; [40] &quot;DNA methylation based StemnessScore&quot;       
#&gt; [41] &quot;Pancan Gene Programs&quot;                      
#&gt; [42] &quot;Immune Model Based Subtype&quot;                
#&gt; [43] &quot;Immune Signature Scores&quot;</code></pre>
<p>Note not all datasets have these property, <code>showTCGA</code> can help you to check it. It will return all data in TCGA, you can use following code in RStudio and search your data.</p>
<pre class="r"><code>View(showTCGA())</code></pre>
<p><strong>OR you can use shiny app provided by <code>UCSCXenaTools</code> to search</strong>.</p>
<p>Run shiny by:</p>
<pre class="r"><code>UCSCXenaTools::XenaShiny()</code></pre>
</div>
</div>
<div id="sessioninfo" class="section level1">
<h1>SessionInfo</h1>
<pre class="r"><code>sessionInfo()
#&gt; R version 4.0.2 (2020-06-22)
#&gt; Platform: x86_64-apple-darwin17.0 (64-bit)
#&gt; Running under: macOS Catalina 10.15.6
#&gt; 
#&gt; Matrix products: default
#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
#&gt; 
#&gt; locale:
#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt; [1] dplyr_1.0.1         UCSCXenaTools_1.3.3
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;  [1] Rcpp_1.0.5       knitr_1.29       magrittr_1.5     hms_0.5.3       
#&gt;  [5] tidyselect_1.1.0 R6_2.4.1         rlang_0.4.7      fansi_0.4.1     
#&gt;  [9] httr_1.4.2       stringr_1.4.0    tools_4.0.2      xfun_0.16       
#&gt; [13] utf8_1.1.4       cli_2.0.2        htmltools_0.5.0  ellipsis_0.3.1  
#&gt; [17] assertthat_0.2.1 yaml_2.2.1       digest_0.6.25    tibble_3.0.3    
#&gt; [21] lifecycle_0.2.0  crayon_1.3.4     bookdown_0.20    readr_1.3.1     
#&gt; [25] purrr_0.3.4      formatR_1.7      vctrs_0.3.2      curl_4.3        
#&gt; [29] glue_1.4.1       evaluate_0.14    rmarkdown_2.3    blogdown_0.20   
#&gt; [33] stringi_1.4.6    compiler_4.0.2   pillar_1.4.6     generics_0.0.2  
#&gt; [37] pkgconfig_2.0.3</code></pre>
</div>
<div id="bug-report" class="section level1">
<h1>Bug Report</h1>
<p>I have no time to test if all conditions are right and all datasets can normally be downloaded. So if you have any question or suggestion, please open an issue on Github at <a href="https://github.com/ShixiangWang/UCSCXenaTools/issues" class="uri">https://github.com/ShixiangWang/UCSCXenaTools/issues</a>.</p>
</div>
<div id="acknowledgement" class="section level1">
<h1>Acknowledgement</h1>
<p>This package is based on <a href="https://github.com/mtmorgan/XenaR">XenaR</a>, thanks <a href="https://github.com/mtmorgan">Martin Morgan</a> for his work.</p>
</div>
<div id="license" class="section level1">
<h1>LICENSE</h1>
<p>GPL-3</p>
<p>Please note, code from XenaR package under Apache 2.0 license.</p>
</div>
